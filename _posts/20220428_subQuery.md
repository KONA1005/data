# 20220428 ì„œë¸Œì¿¼ë¦¬

# ì„œë¸Œì¿¼ë¦¬

SQL ë¬¸ì¥ ì•ˆì—ì„œ ë³´ì¡°ë¡œ ì‚¬ìš©ë˜ëŠ” ë˜ ë‹¤ë¥¸ SELECTë¬¸

<aside>
ğŸ’¡ **ë©”ì¸ì¿¼ë¦¬ë¥¼ ë¨¼ì € í’€ì–´ë³´ê³  ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.**

</aside>

- ë©”ì¸ ì¿¼ë¦¬ì™€ì˜ ì—°ê´€ì„±ì— ë”°ë¼
    - ì—°ê´€ì„± ì—†ëŠ” ì„œë¸Œ ì¿¼ë¦¬
    - ì—°ê´€ì„± ìˆëŠ” ì„œë¸Œ ì¿¼ë¦¬
- í˜•íƒœì— ë”°ë¼
    - ì¼ë°˜ ì„œë¸Œ ì¿¼ë¦¬(SELECT)
    - ì¸ë¼ì¸ ë·°(FROM)
    - ì¤‘ì²© ì¿¼ë¦¬(WHERE)

## 1. ë©”ì¸ì¿¼ë¦¬ì™€ì˜ ì—°ê´€ì„±

### (1) ì—°ê´€ì„± ì—†ëŠ” ì„œë¸Œ ì¿¼ë¦¬

- ë©”ì¸ í…Œì´ë¸”ê³¼ ì¡°ì¸ ì¡°ê±´ì´ ê±¸ë¦¬ì§€ ì•ŠëŠ” ì„œë¸Œ ì¿¼ë¦¬

![Untitled](/images/20220428_subQuery/Untitled.png)

- ì „ ì‚¬ì›ì˜ í‰ê·  ê¸‰ì—¬ ì´ìƒì„ ë°›ëŠ” ì‚¬ì› ìˆ˜ ì¡°íšŒ ì¿¼ë¦¬.
    - ë©”ì¸ ì¿¼ë¦¬ì™€ ì„œë¸Œ ì¿¼ë¦¬ ì‚¬ì´ì˜ ì—°ê´€ì„±ì€ ì—†ë‹¤.

![Untitled](/images/20220428_subQuery/Untitled%201.png)

- parent_idê°€ NULLì¸ ë¶€ì„œë²ˆí˜¸ë¥¼ ê°€ì§„ ì‚¬ì›ì˜ ì´ ê±´ìˆ˜
- ë©”ì¸ = ì‚¬ì› í…Œì´ë¸” , ê´„í˜¸ ì•ˆ ì„œë¸Œ ì¿¼ë¦¬ ì‚¬ì›í…Œì´ë¸”ê³¼ ê´€ë ¨ X

![Untitled](/images/20220428_subQuery/Untitled%202.png)

- job_history í…Œì´ë¸”ì— ìˆëŠ” employee_id, job_id ë‘ ê°’ê³¼ ê°™ì€ ê±´ì„ ì‚¬ì› í…Œì´ë¸”ì—ì„œ ì°¾ëŠ” ì¿¼ë¦¬. ë©”ì¸ ì¿¼ë¦¬ì™€ ì„œë¸Œ ì¿¼ë¦¬ ì—°ê´€ X
- ë‘ê°œì´ìƒì˜ ì»¬ëŸ¼ì´ ê°™ì€ê±¸ ì°¾ê³  ì‹¶ë‹¤? = IN
- IN ì“¸ë•Œ ì»¬ëŸ¼ê°œìˆ˜ ìœ í˜• ê°™ì•„ì•¼ í•¨

### (2) ì—°ê´€ì„± ìˆëŠ” ì„œë¸Œ ì¿¼ë¦¬

- ë©”ì¸ í…Œì´ë¸”ê³¼ ì¡°ì¸ ì¡°ê±´ì´ ê±¸ë¦° ì„œë¸Œ ì¿¼ë¦¬
    - ë§¤ì¹­ì´ ë˜ë©´ 1ë¡œ í‘œì‹œí•´ë¼
    - ë§¤ì¹­ì´ ë˜ë©´ ì•„ì´ë””ë¥¼ ê°€ì ¸ì™€ë¼

![Untitled](/images/20220428_subQuery/Untitled%203.png)

- ì„œë¸Œì¿¼ë¦¬ ì•ˆì—ì„œ ë©”ì¸ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©ëœ ë¶€ì„œ í…Œì´ë¸”ì˜ ë¶€ì„œë²ˆí˜¸ì™€ job_history í…Œì´ë¸”ì˜ ë¶€ì„œë²ˆí˜¸ê°€ ê°™ì€ ê±´ì„ ì¡°íšŒ.
- EXISTS ì‚¬ìš©í•´ ì„œë¸Œ ì¿¼ë¦¬ ë‚´ì— ì¡°ì¸ ì¡°ê±´ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.
    - ê²°ê³¼ = job_history í…Œì´ë¸”ì— ìˆëŠ” ë¶€ì„œë§Œ ì¡°íšŒë¨
    
    ![Untitled](/images/20220428_subQuery/Untitled%204.png)
    
- job_history í…Œì´ë¸”ì„ ì¡°íšŒí•˜ê³  ìˆëŠ”ë° job_historyì—ëŠ” ì‚¬ë²ˆ, ë¶€ì„œë²ˆí˜¸ë§Œ ì¡´ì¬
- ì‚¬ì›ëª…ê³¼ ë¶€ì„œëª…ì„ ê°€ì ¸ì˜¤ë ¤ê³  ì„œë¸Œ ì¿¼ë¦¬ë¥¼ SELECTì ˆì—ì„œ ì‚¬ìš© â†’ ì„œë¸Œ ì¿¼ë¦¬ ì•ˆì˜ WHEREì ˆì— ì¡°ê±´ ì¶”ê°€
- ì—¬ëŸ¬ê°œì˜ ì„œë¸Œ ì¿¼ë¦¬ ê°€ëŠ¥í•˜ë‹¤.

## 2. ì¸ë¼ì¸ ë·°

- FROM ì ˆì— ì‚¬ìš© í•˜ëŠ” ì„œë¸Œ ì¿¼ë¦¬

![Untitled](/images/20220428_subQuery/Untitled%205.png)

- ê¸°íšë¶€(90) ì‚°í•˜ì— ìˆëŠ” ë¶€ì„œì— ì†í•œ ì‚¬ì›ì˜ í‰ê· ê¸‰ì—¬ë³´ë‹¤ ë§ì€ ê¸‰ì—¬ë¥¼ ë°›ëŠ” ì‚¬ì› ëª©ë¡ì„ ì¶”ì¶œí•œ ê²ƒ.
- ê¸°íšë¶€ ì‚°í•˜ í‰ê· ê¸‰ì—¬ë¥¼ êµ¬í•˜ëŠ” ë¶€ë¶„ì„ ì„œë¸Œ ì¿¼ë¦¬ë¡œ ì‘ì„±.

### â€”ì˜ˆì œâ€”

- 2000ë…„ ì´íƒˆë¦¬ì•„ í‰ê·  ë§¤ì¶œì•¡(ì—°í‰ê· ) ë³´ë‹¤ í° ì›”ì˜ í‰ê·  ë§¤ì¶œì•¡ êµ¬í•˜ê¸°

![Untitled](/images/20220428_subQuery/Untitled%206.png)

![Untitled](/images/20220428_subQuery/Untitled%207.png)

- ì²« ë²ˆì§¸ ì„œë¸Œ ì¿¼ë¦¬
    - ì›”ë³„ í‰ê·  ë§¤ì¶œì•¡
- ë‘ ë²ˆì§¸ ì„œë¸Œ ì¿¼ë¦¬
    - ì—°í‰ê·  ë§¤ì¶œì•¡
- ê²°ê³¼
    - ì›” í‰ê· ë§¤ì¶œì•¡ > ì—°í‰ê·  ë§¤ì¶œì•¡ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì›”ì˜ í‰ê· ë§¤ì¶œ

### (1) ë³µì¡í•œ ì¿¼ë¦¬

1. ìµœì¢…ì ìœ¼ë¡œ ì¡°íšŒë˜ëŠ” ê²°ê³¼ í•­ëª©ì„ ì •ì˜í•œë‹¤.
2. í•„ìš”í•œ í…Œì´ë¸”ê³¼ ì»¬ëŸ¼ì„ íŒŒì•…í•œë‹¤.
3. ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í• í•´ì„œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•œë‹¤.
4. ë¶„í• í•œ ë‹¨ìœ„ì˜ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ë¡œ í•©ì³ ìµœì¢… ê²°ê³¼ë¥¼ ì‚°ì¶œí•œë‹¤.
5. ê²°ê³¼ë¥¼ ê²€ì¦í•œë‹¤.

### â€” ì˜ˆì œ â€”

ì—°ë„ë³„ë¡œ ì´íƒˆë¦¬ì•„ ë§¤ì¶œ ë°ì´í„°ë¥¼ ì‚´í´ ë§¤ì¶œì‹¤ì ì´ ê°€ì¥ ë§ì€ ì‚¬ì›ì˜ ëª©ë¡ê³¼ ë§¤ì¶œì•¡ êµ¬í•˜ê¸°

- ì—°ë„, ìµœëŒ€ë§¤ì¶œì‚¬ì›, ìµœëŒ€ë§¤ì¶œì•¡
- ì´íƒˆë¦¬ì•„ ì°¾ê¸° : countries
- ì´íƒˆë¦¬ì•„ ê³ ê° : customers
- ë§¤ì¶œ : sales
- ì‚¬ì› ì •ë³´ : employees

### 1) ì—°ë„, ì‚¬ì›ë³„ ì´íƒˆë¦¬ì•„ ë§¤ì¶œì•¡ êµ¬í•˜ê¸°

- ì´íƒˆë¦¬ì•„ ê³ ê° ì°¾ê¸° : customers, countriesë¥¼ country_idë¡œ ì¡°ì¸
- ì´íƒˆë¦¬ì•„ ë§¤ì¶œ ì°¾ê¸° : ìœ„ ê²°ê³¼ì™€ slaes í…Œì´ë¸”ì„ cust_idë¡œ ì¡°ì¸
- ìµœëŒ€ë§¤ì¶œì•¡ êµ¬í•˜ë ¤ë©´ MAXí•¨ìˆ˜ ì“°ê³  ì—°ë„ë³„ë¡œ GROUP BY

![Untitled](/images/20220428_subQuery/Untitled%208.png)

### 2) ìœ„ ê²°ê³¼ì—ì„œ ì—°ë„ë³„ ìµœëŒ€, ìµœì†Œ ë§¤ì¶œì•¡ êµ¬í•˜ê¸°

![Untitled](/images/20220428_subQuery/Untitled%209.png)

### 3) 1ì˜ ê²°ê³¼ì™€ 2 ê²°ê³¼ ì¡°ì¸í•´ì„œ ìµœëŒ€ë§¤ì¶œ, ìµœì†Œë§¤ì¶œì•¡ ì‚¬ì› ì°¾ê¸°

```bash
SELECT 
    emp.years
    , emp.employee_id
    , emp2.emp_name
    , emp.amount_sold
FROM 
    (SELECT 
        SUBSTR(a.sales_month, 1, 4) as years
        , a.employee_id
        , SUM(a.amount_sold) AS amount_sold
     FROM 
        sales a
        , customers b 
        , countries c 
     WHERE a.cust_id = b.cust_id
        AND b.country_id = c.country_id 
        AND c.country_name = 'Italy' 
     GROUP BY SUBSTR(a.sales_month, 1, 4), a.employee_id) emp
    , (SELECT 
         years
         , MAX(amount_sold) AS max_sold
         , MIN(amount_sold) AS min_sold
         FROM (SELECT 
                 SUBSTR(a.sales_month, 1, 4) as years
                 , a.employee_id
                 , SUM(a.amount_sold) AS amount_sold
               FROM 
                sales a
                , customers b 
                , countries c 
               WHERE a.cust_id = b.cust_id
                  AND b.country_id = c.country_id 
                  AND c.country_name = 'Italy' 
               GROUP BY SUBSTR(a.sales_month, 1, 4), a.employee_id) K 
         GROUP BY years) sale
    , employees emp2
WHERE emp.years = sale.years
    AND emp.amount_sold = sale.max_sold
    AND emp.employee_id = emp2.employee_id
ORDER BY years;
```

![Untitled](/images/20220428_subQuery/Untitled%2010.png)